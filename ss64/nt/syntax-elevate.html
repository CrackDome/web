<!doctype html><html lang="en">

<!-- Mirrored from ss64.com/nt/syntax-elevate.html by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 29 Aug 2020 00:08:46 GMT -->

<head><meta charset="UTF-8">
<meta name="viewport" content="width=768, initial-scale=1">
<link rel="STYLESHEET" href="../main.css" type="text/css">
<title>Run with elevated permissions UAC - Windows CMD - SS64.com</title>
</head>
<body><!-- #BeginLibraryItem "/Library/head_ntsyntax.lbi" --><div id="tnav"><ul>
<li class="tbtn"><a href="../index.html">SS64</a></li>
<li class="tbtn"><a href="index.html">CMD <svg viewBox="0 0 13 20.1" width="13" height="13" style="transform: rotate(0deg);"><path d="M0 2.9l7.2 7.2-7.1 7.1L3 20.1l7.1-7.1 2.9-2.9L2.9 0 0 2.9"></path></svg></a></li>
<li class="tbtn"><a href="syntax.html">How-to <svg viewBox="0 0 13 20.1" width="13" height="13" style="transform: rotate(0deg);"><path d="M0 2.9l7.2 7.2-7.1 7.1L3 20.1l7.1-7.1 2.9-2.9L2.9 0 0 2.9"></path></svg></a></li>
<li><div id="search"><form action="https://www.google.com/search" method="get">
<input type="text" name="q" id="q" size="27" maxlength="255">
<input class="submit" value="Search" id="btn" type="submit">
<input type="hidden" name="sitesearch" value="ss64.com/nt/"></form></div></li>
</ul></div><!-- #EndLibraryItem --><h1>How-to: Run with elevated permissions </h1>
<blockquote>
<p>The CMD shell, <a href="start.html">START</a> and <a href="runas.html">RUNAS</a> commands have no built-in options to elevate or run individual commands 'As Admin' (elevated).</p>
<p>When using the Start Menu, hold down <a href="syntax-keyboard.html" class="code">Shift+Ctrl</a> when launching an application to launch  it 'As Admin' (elevated) this has the same effect as if you right click and select Run as  local Administrator.</p>
<p>To run an item on the Start menu / Search /Desktop elevated, select it and then press <span class="code">Ctrl+Shift+Enter</span> on the keyboard.</p>
<p> It is also possible to right click CMD.exe (or it's Start menu shortcut) and run a  new session 'As Admin'.</p>
<p> Shortcuts can be edited to always run as Admin - <span class="code">Properties | Shortcut | Advanced</span> then tick &quot;Run as administrator&quot;.</p>
<p>To elevate from the command line will require running either <a href="../vb/syntax-elevate.html">VBScript</a> or <a href="../ps/syntax-elevate.html">PowerShell</a>, this does not have to involve completely rewriting existing scripts,  you can use a couple of lines of either VBScript or PowerShell to launch an elevated CMD.exe and that will run a batch file elevated.</p>
<p>Another approach is to use a third party utility that will elevate permissions.</p>
<p>When a script is run with elevated permissions several aspects of the user environment will change: The <a href="cd.html">current directory</a>, the current TEMP folder and any mapped drives will be disconnected.</p>
</blockquote>
<h2>Testing for Elevation</h2>
<blockquote>
<p>Testing if the current session is elevated  can be done with the FSUTIL command (via <a href="https://stackoverflow.com/a/21295806/1720814">StackOverflow</a>) or SFC. <br>
</p>
<pre>fsutil dirty query %SYSTEMDRIVE% &gt;nul
If %errorLevel% NEQ 0 (
   Echo Failure, please rerun this script from an elevated command prompt. Exiting...
   Ping 127.0.0.1 3&gt;&amp;1 &gt; nul
   Exit /B 1
) 
Echo Success: this script is running elevated.</pre>
<p>Windows 7 does not require passing a drive letter to <a href="fsutil.html">FSUTIL</a>, Windows 8 and 10 do.</p>
</blockquote>
<h2>Run without Elevation</h2>
<blockquote>
<p>In some cases you may wish to run an application without elevation, this will restrict what the application can do.</p>
<p>The undocumented <a href="syntax-variables.html#undocumented">environment</a> variable <span class="code">__COMPAT_LAYER</span> can be used to lower  the ExecutionLevel to <span class="code">RunAsInvoker</span></p>
<p class="code">@Echo Off<br>
SETLOCAL<br>
Set __COMPAT_LAYER=RunAsInvoker <br>
regedit.exe</p>
<p>The example above will run <a href="regedit.html">REGEDIT</a> using the user's native permissions,   attempting to modify any protected area of the registry (such as HKLM) within this session will produce an error. Without this, by default Regedit will  run elevated.</p></blockquote>
<h2>Scheduled Tasks</h2>
<blockquote>
<p>If a scheduled task invokes a  UAC prompt, then the  task will fail to run unattended.<br>
To run a task elevated,   select the check box 'Run With Highest Privileges':</p>
<p><img src="elevate.png" width="203" height="94" alt="Elevate Scheduled task"></p>
</blockquote>
<p class="quote"><i>&ldquo;A man in public life expects to be sneered at &ndash; it is the fault of his elevated situation, and not of himself&rdquo; ~ Charles Dickens</i></p>
<p><b>Related</b><p class="space"><a href="syntax-compatibility.html">Compatibility</a> - Backwards compatibility - runas admin / color - this can also force elevation.<br>
PowerShell: <a href="../ps/syntax-elevate.html">Run with Elevated Permissions</a><br>
VBScript: <a href="../vb/syntax-elevate.html">Run with Elevated Permissions</a><br>
<a href="https://ss64.org/viewtopic.php?id=1491">SS64 Forum thread</a> on UAC detection.<br>
<a href="https://code.kliu.org/misc/elevate/">elevate</a> - Command-Line UAC Elevation Utility.
<!-- #BeginLibraryItem "/Library/foot_nt.lbi" --><p>
<script async src="../../pagead2.googlesyndication.com/pagead/js/f.txt"></script>
<!-- windows300 -->
<ins class="adsbygoogle"
     style="display:inline-block;width:300px;height:250px"
     data-ad-client="ca-pub-6140977852749469"
     data-ad-slot="7649547908"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
</p>
<hr>
<div id=bl>&nbsp;</div>
<div id=br>Copyright &copy; 1999-2020 <a href="../index.html">SS64.com</a><br>
Some rights reserved</div><!-- #EndLibraryItem --></body>

<!-- Mirrored from ss64.com/nt/syntax-elevate.html by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 29 Aug 2020 00:08:46 GMT -->
</html>